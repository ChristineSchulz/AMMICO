<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notebook for text extraction on image &mdash; AMMICO 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Image summary and visual question answering" href="Example%20summary.html" />
    <link rel="prev" title="Facial Expression recognition with DeepFace" href="Example%20faces.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AMMICO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme_link.html">AMMICO - AI Media and Misinformation Content Analysis Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example%20faces.html">Facial Expression recognition with DeepFace</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Notebook for text extraction on image</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Google-cloud-vision-API">Google cloud vision API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Inspect-the-elements-per-image">Inspect the elements per image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Or-directly-analyze-for-further-processing">Or directly analyze for further processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Convert-to-dataframe-and-write-csv">Convert to dataframe and write csv</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Topic-analysis">Topic analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Option-1:-Use-the-dictionary-as-obtained-from-the-above-analysis.">Option 1: Use the dictionary as obtained from the above analysis.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Option-2:-Read-in-a-csv">Option 2: Read in a csv</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Access-frequent-topics">Access frequent topics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Get-information-for-specific-topic">Get information for specific topic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Topic-visualization">Topic visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Save-the-model">Save the model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Example%20summary.html">Image summary and visual question answering</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example%20multimodal.html">Image Multimodal Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example%20colors.html">Color analysis of pictures</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example%20objects.html">Objects recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example%20cropposts.html">Crop posts from social media posts images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">AMMICO package modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license_link.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AMMICO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Notebook for text extraction on image</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/Example text.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Notebook-for-text-extraction-on-image">
<h1>Notebook for text extraction on image<a class="headerlink" href="#Notebook-for-text-extraction-on-image" title="Permalink to this heading"></a></h1>
<p>The text extraction and analysis is carried out using a variety of tools:</p>
<ol class="arabic simple">
<li><p>Text extraction from the image using <a class="reference external" href="https://cloud.google.com/vision">google-cloud-vision</a></p></li>
<li><p>Language detection of the extracted text using <a class="reference external" href="https://py-googletrans.readthedocs.io/en/latest/">Googletrans</a></p></li>
<li><p>Translation into English or other languages using <a class="reference external" href="https://py-googletrans.readthedocs.io/en/latest/">Googletrans</a></p></li>
<li><p>Cleaning of the text using <a class="reference external" href="https://spacy.io/">spacy</a></p></li>
<li><p>Spell-check using <a class="reference external" href="https://textblob.readthedocs.io/en/dev/index.html">TextBlob</a></p></li>
<li><p>Subjectivity analysis using <a class="reference external" href="https://textblob.readthedocs.io/en/dev/index.html">TextBlob</a></p></li>
<li><p>Text summarization using <a class="reference external" href="https://huggingface.co/docs/transformers/index">transformers</a> pipelines</p></li>
<li><p>Sentiment analysis using <a class="reference external" href="https://huggingface.co/docs/transformers/index">transformers</a> pipelines</p></li>
<li><p>Named entity recognition using <a class="reference external" href="https://huggingface.co/docs/transformers/index">transformers</a> pipelines</p></li>
<li><p>Topic analysis using <a class="reference external" href="https://github.com/MaartenGr/BERTopic">BERTopic</a></p></li>
</ol>
<p>The first cell is only run on google colab and installs the <a class="reference external" href="https://github.com/ssciwr/AMMICO">ammico</a> package.</p>
<p>After that, we can import <code class="docutils literal notranslate"><span class="pre">ammico</span></code> and read in the files given a folder path.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># if running on google colab</span>
<span class="c1"># flake8-noqa-cell</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">()):</span>
    <span class="c1"># update python version</span>
    <span class="c1"># install setuptools</span>
    <span class="c1"># %pip install setuptools==61 -qqq</span>
    <span class="c1"># install ammico</span>
    <span class="o">%</span><span class="k">pip</span> install git+https://github.com/ssciwr/ammico.git -qqq
    <span class="c1"># mount google drive for data and API key</span>
    <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>

    <span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;/content/drive&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">ammico</span>
<span class="kn">from</span> <span class="nn">ammico</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">mutils</span>
<span class="kn">from</span> <span class="nn">ammico</span> <span class="kn">import</span> <span class="n">display</span> <span class="k">as</span> <span class="n">mdisplay</span>
</pre></div>
</div>
</div>
<p>We select a subset of image files to try the text extraction on, see the <code class="docutils literal notranslate"><span class="pre">limit</span></code> keyword. The <code class="docutils literal notranslate"><span class="pre">find_files</span></code> function finds image files within a given directory:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here you need to provide the path to your google drive folder</span>
<span class="c1"># or local folder containing the images</span>
<span class="n">images</span> <span class="o">=</span> <span class="n">mutils</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;data/&quot;</span><span class="p">,</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>We need to initialize the main dictionary that contains all information for the images and is updated through each subsequent analysis:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mydict</span> <span class="o">=</span> <span class="n">mutils</span><span class="o">.</span><span class="n">initialize_dict</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Google-cloud-vision-API">
<h2>Google cloud vision API<a class="headerlink" href="#Google-cloud-vision-API" title="Permalink to this heading"></a></h2>
<p>For this you need an API key and have the app activated in your google console. The first 1000 images per month are free (July 2022).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>os.environ[
    &quot;GOOGLE_APPLICATION_CREDENTIALS&quot;
] = &quot;your-credentials.json&quot;
</pre></div>
</div>
</section>
<section id="Inspect-the-elements-per-image">
<h2>Inspect the elements per image<a class="headerlink" href="#Inspect-the-elements-per-image" title="Permalink to this heading"></a></h2>
<p>To check the analysis, you can inspect the analyzed elements here. Loading the results takes a moment, so please be patient. If you are sure of what you are doing, you can skip this and directly export a csv file in the step below. Here, we display the text extraction and translation results provided by the above libraries. Click on the tabs to see the results in the right sidebar. You may need to increment the <code class="docutils literal notranslate"><span class="pre">port</span></code> number if you are already running several notebook instances on the same
server.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysis_explorer</span> <span class="o">=</span> <span class="n">mdisplay</span><span class="o">.</span><span class="n">AnalysisExplorer</span><span class="p">(</span><span class="n">mydict</span><span class="p">,</span> <span class="n">identify</span><span class="o">=</span><span class="s2">&quot;text-on-image&quot;</span><span class="p">)</span>
<span class="n">analysis_explorer</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8054</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[5], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> analysis_explorer <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">mdisplay</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">AnalysisExplorer</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">mydict</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">identify</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">text-on-image</span><span class="ansi-yellow-bg" style="color: rgb(175,0,0)">&#34;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> analysis_explorer<span style="color: rgb(98,98,98)">.</span>run_server(port<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">8054</span>)

<span class="ansi-red-fg">TypeError</span>: __init__() got an unexpected keyword argument &#39;identify&#39;
</pre></div></div>
</div>
</section>
<section id="Or-directly-analyze-for-further-processing">
<h2>Or directly analyze for further processing<a class="headerlink" href="#Or-directly-analyze-for-further-processing" title="Permalink to this heading"></a></h2>
<p>Instead of inspecting each of the images, you can also directly carry out the analysis and export the result into a csv. This may take a while depending on how many images you have loaded. Set the keyword <code class="docutils literal notranslate"><span class="pre">analyse_text</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want the text to be analyzed (spell check, subjectivity, text summary, sentiment, NER).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mydict</span><span class="p">:</span>
    <span class="n">mydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ammico</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextDetector</span><span class="p">(</span>
        <span class="n">mydict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">analyse_text</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">analyse_image</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">_InactiveRpcError</span>                         Traceback (most recent call last)
File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/google/api_core/grpc_helpers.py:72</span>, in <span class="ansi-cyan-fg">_wrap_unary_errors.&lt;locals&gt;.error_remapped_callable</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     71</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">---&gt; 72</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">callable_</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     73</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> grpc<span style="color: rgb(98,98,98)">.</span>RpcError <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> exc:

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/grpc/_channel.py:1030</span>, in <span class="ansi-cyan-fg">_UnaryUnaryMultiCallable.__call__</span><span class="ansi-blue-fg">(self, request, timeout, metadata, credentials, wait_for_ready, compression)</span>
<span class="ansi-green-intense-fg ansi-bold">   1028</span> state, call, <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_blocking(request, timeout, metadata, credentials,
<span class="ansi-green-intense-fg ansi-bold">   1029</span>                               wait_for_ready, compression)
<span class="ansi-green-fg">-&gt; 1030</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">_end_unary_response_blocking</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">state</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">call</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">None</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/grpc/_channel.py:910</span>, in <span class="ansi-cyan-fg">_end_unary_response_blocking</span><span class="ansi-blue-fg">(state, call, with_call, deadline)</span>
<span class="ansi-green-intense-fg ansi-bold">    909</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">--&gt; 910</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> _InactiveRpcError(state)

<span class="ansi-red-fg">_InactiveRpcError</span>: &lt;_InactiveRpcError of RPC that terminated with:
        status = StatusCode.PERMISSION_DENIED
        details = &#34;This API method requires billing to be enabled. Please enable billing on project #787789355044 by visiting https://console.developers.google.com/billing/enable?project=787789355044 then retry. If you enabled billing for this project recently, wait a few minutes for the action to propagate to our systems and retry.&#34;
        debug_error_string = &#34;UNKNOWN:Error received from peer ipv4:142.251.116.95:443 {grpc_message:&#34;This API method requires billing to be enabled. Please enable billing on project #787789355044 by visiting https://console.developers.google.com/billing/enable?project=787789355044 then retry. If you enabled billing for this project recently, wait a few minutes for the action to propagate to our systems and retry.&#34;, grpc_status:7, created_time:&#34;2023-07-03T12:19:39.039502111+00:00&#34;}&#34;
&gt;

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">PermissionDenied</span>                          Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[6], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> key <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> mydict:
<span class="ansi-green-fg">----&gt; 2</span>     mydict[key] <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">ammico</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">text</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">TextDetector</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mydict</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">analyse_text</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">analyse_image</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/work/AMMICO/AMMICO/ammico/text.py:148</span>, in <span class="ansi-cyan-fg">TextDetector.analyse_image</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    142</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">analyse_image</span>(<span style="color: rgb(0,135,0)">self</span>) <span style="color: rgb(98,98,98)">-</span><span style="color: rgb(98,98,98)">&gt;</span> <span style="color: rgb(0,135,0)">dict</span>:
<span class="ansi-green-intense-fg ansi-bold">    143</span> <span style="color: rgb(188,188,188)">    </span><span style="color: rgb(175,0,0)">&#34;&#34;&#34;Perform text extraction and analysis of the text.</span>
<span class="ansi-green-intense-fg ansi-bold">    144</span>
<span class="ansi-green-intense-fg ansi-bold">    145</span> <span style="color: rgb(175,0,0)">    Returns:</span>
<span class="ansi-green-intense-fg ansi-bold">    146</span> <span style="color: rgb(175,0,0)">        dict: The updated dictionary with text analysis results.</span>
<span class="ansi-green-intense-fg ansi-bold">    147</span> <span style="color: rgb(175,0,0)">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 148</span>     <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">get_text_from_image</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    149</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>translate_text()
<span class="ansi-green-intense-fg ansi-bold">    150</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>remove_linebreaks()

File <span class="ansi-green-fg">~/work/AMMICO/AMMICO/ammico/text.py:171</span>, in <span class="ansi-cyan-fg">TextDetector.get_text_from_image</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    169</span> <span style="color: rgb(95,135,135)"># check for usual connection errors and retry if necessary</span>
<span class="ansi-green-intense-fg ansi-bold">    170</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 171</span>     response <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">client</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">text_detection</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">image</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">image</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> grpc<span style="color: rgb(98,98,98)">.</span>RpcError <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> exc:
<span class="ansi-green-intense-fg ansi-bold">    173</span>     <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Cloud vision API connection failed</span><span style="color: rgb(175,0,0)">&#34;</span>)

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/google/cloud/vision_helpers/decorators.py:112</span>, in <span class="ansi-cyan-fg">_create_single_feature_method.&lt;locals&gt;.inner</span><span class="ansi-blue-fg">(self, image, max_results, retry, timeout, metadata, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    110</span>     copied_features[<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">max_results</span><span style="color: rgb(175,0,0)">&#34;</span>] <span style="color: rgb(98,98,98)">=</span> max_results
<span class="ansi-green-intense-fg ansi-bold">    111</span> request <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">dict</span>(image<span style="color: rgb(98,98,98)">=</span>image, features<span style="color: rgb(98,98,98)">=</span>[copied_features], <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">--&gt; 112</span> response <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">annotate_image</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">    113</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">retry</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">retry</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">metadata</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">metadata</span>
<span class="ansi-green-intense-fg ansi-bold">    114</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> response

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/google/cloud/vision_helpers/__init__.py:76</span>, in <span class="ansi-cyan-fg">VisionHelpers.annotate_image</span><span class="ansi-blue-fg">(self, request, retry, timeout, metadata)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">len</span>(request<span style="color: rgb(98,98,98)">.</span>features) <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">0</span>:
<span class="ansi-green-intense-fg ansi-bold">     75</span>     request<span style="color: rgb(98,98,98)">.</span>features <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_get_all_features()
<span class="ansi-green-fg">---&gt; 76</span> r <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">batch_annotate_images</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">     77</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">requests</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">retry</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">retry</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">metadata</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">metadata</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> r<span style="color: rgb(98,98,98)">.</span>responses[<span style="color: rgb(98,98,98)">0</span>]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/google/cloud/vision_v1/services/image_annotator/client.py:564</span>, in <span class="ansi-cyan-fg">ImageAnnotatorClient.batch_annotate_images</span><span class="ansi-blue-fg">(self, request, requests, retry, timeout, metadata)</span>
<span class="ansi-green-intense-fg ansi-bold">    561</span> rpc <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_transport<span style="color: rgb(98,98,98)">.</span>_wrapped_methods[<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_transport<span style="color: rgb(98,98,98)">.</span>batch_annotate_images]
<span class="ansi-green-intense-fg ansi-bold">    563</span> <span style="color: rgb(95,135,135)"># Send the request.</span>
<span class="ansi-green-fg">--&gt; 564</span> response <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">rpc</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">    565</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">request</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    566</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">retry</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">retry</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    567</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    568</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">metadata</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">metadata</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    569</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    571</span> <span style="color: rgb(95,135,135)"># Done; return the response.</span>
<span class="ansi-green-intense-fg ansi-bold">    572</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> response

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/google/api_core/gapic_v1/method.py:113</span>, in <span class="ansi-cyan-fg">_GapicCallable.__call__</span><span class="ansi-blue-fg">(self, timeout, retry, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    110</span>     metadata<span style="color: rgb(98,98,98)">.</span>extend(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_metadata)
<span class="ansi-green-intense-fg ansi-bold">    111</span>     kwargs[<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">metadata</span><span style="color: rgb(175,0,0)">&#34;</span>] <span style="color: rgb(98,98,98)">=</span> metadata
<span class="ansi-green-fg">--&gt; 113</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">wrapped_func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/google/api_core/grpc_helpers.py:74</span>, in <span class="ansi-cyan-fg">_wrap_unary_errors.&lt;locals&gt;.error_remapped_callable</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     72</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> callable_(<span style="color: rgb(98,98,98)">*</span>args, <span style="color: rgb(98,98,98)">*</span><span style="color: rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-intense-fg ansi-bold">     73</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> grpc<span style="color: rgb(98,98,98)">.</span>RpcError <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> exc:
<span class="ansi-green-fg">---&gt; 74</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> exceptions<span style="color: rgb(98,98,98)">.</span>from_grpc_error(exc) <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">exc</span>

<span class="ansi-red-fg">PermissionDenied</span>: 403 This API method requires billing to be enabled. Please enable billing on project #787789355044 by visiting https://console.developers.google.com/billing/enable?project=787789355044 then retry. If you enabled billing for this project recently, wait a few minutes for the action to propagate to our systems and retry. [links {
  description: &#34;Google developers console billing&#34;
  url: &#34;https://console.developers.google.com/billing/enable?project=787789355044&#34;
}
, reason: &#34;BILLING_DISABLED&#34;
domain: &#34;googleapis.com&#34;
metadata {
  key: &#34;service&#34;
  value: &#34;vision.googleapis.com&#34;
}
metadata {
  key: &#34;consumer&#34;
  value: &#34;projects/787789355044&#34;
}
]
</pre></div></div>
</div>
</section>
<section id="Convert-to-dataframe-and-write-csv">
<h2>Convert to dataframe and write csv<a class="headerlink" href="#Convert-to-dataframe-and-write-csv" title="Permalink to this heading"></a></h2>
<p>These steps are required to convert the dictionary of dictionarys into a dictionary with lists, that can be converted into a pandas dataframe and exported to a csv file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outdict</span> <span class="o">=</span> <span class="n">mutils</span><span class="o">.</span><span class="n">append_data_to_dict</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">mutils</span><span class="o">.</span><span class="n">dump_df</span><span class="p">(</span><span class="n">outdict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[7], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> outdict <span style="color: rgb(98,98,98)">=</span> mutils<span style="color: rgb(98,98,98)">.</span>append_data_to_dict(mydict)
<span class="ansi-green-fg">----&gt; 2</span> df <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">mutils</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">dump_df</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">outdict</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/work/AMMICO/AMMICO/ammico/utils.py:171</span>, in <span class="ansi-cyan-fg">dump_df</span><span class="ansi-blue-fg">(mydict)</span>
<span class="ansi-green-intense-fg ansi-bold">    169</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span> <span style="color: rgb(0,0,255)">dump_df</span>(mydict: <span style="color: rgb(0,135,0)">dict</span>) <span style="color: rgb(98,98,98)">-</span><span style="color: rgb(98,98,98)">&gt;</span> DataFrame:
<span class="ansi-green-intense-fg ansi-bold">    170</span> <span style="color: rgb(188,188,188)">    </span><span style="color: rgb(175,0,0)">&#34;&#34;&#34;Utility to dump the dictionary into a dataframe.&#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; 171</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">DataFrame</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">from_dict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">mydict</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/pandas/core/frame.py:1760</span>, in <span class="ansi-cyan-fg">DataFrame.from_dict</span><span class="ansi-blue-fg">(cls, data, orient, dtype, columns)</span>
<span class="ansi-green-intense-fg ansi-bold">   1754</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-intense-fg ansi-bold">   1755</span>         <span style="color: rgb(175,0,0)">f</span><span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Expected </span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">index</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">, </span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">columns</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)"> or </span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">tight</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)"> for orient parameter. </span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">   1756</span>         <span style="color: rgb(175,0,0)">f</span><span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Got </span><span style="color: rgb(175,0,0)">&#39;</span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>orient<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)"> instead</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">   1757</span>     )
<span class="ansi-green-intense-fg ansi-bold">   1759</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> orient <span style="color: rgb(98,98,98)">!=</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">tight</span><span style="color: rgb(175,0,0)">&#34;</span>:
<span class="ansi-green-fg">-&gt; 1760</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">cls</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">index</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">index</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1761</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">   1762</span>     realdata <span style="color: rgb(98,98,98)">=</span> data[<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">data</span><span style="color: rgb(175,0,0)">&#34;</span>]

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/pandas/core/frame.py:709</span>, in <span class="ansi-cyan-fg">DataFrame.__init__</span><span class="ansi-blue-fg">(self, data, index, columns, dtype, copy)</span>
<span class="ansi-green-intense-fg ansi-bold">    703</span>     mgr <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_init_mgr(
<span class="ansi-green-intense-fg ansi-bold">    704</span>         data, axes<span style="color: rgb(98,98,98)">=</span>{<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">index</span><span style="color: rgb(175,0,0)">&#34;</span>: index, <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">columns</span><span style="color: rgb(175,0,0)">&#34;</span>: columns}, dtype<span style="color: rgb(98,98,98)">=</span>dtype, copy<span style="color: rgb(98,98,98)">=</span>copy
<span class="ansi-green-intense-fg ansi-bold">    705</span>     )
<span class="ansi-green-intense-fg ansi-bold">    707</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">isinstance</span>(data, <span style="color: rgb(0,135,0)">dict</span>):
<span class="ansi-green-intense-fg ansi-bold">    708</span>     <span style="color: rgb(95,135,135)"># GH#38939 de facto copy defaults to False only in non-dict cases</span>
<span class="ansi-green-fg">--&gt; 709</span>     mgr <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">dict_to_mgr</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">index</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">copy</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">copy</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">typ</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">manager</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    710</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">isinstance</span>(data, ma<span style="color: rgb(98,98,98)">.</span>MaskedArray):
<span class="ansi-green-intense-fg ansi-bold">    711</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">from</span> <span class="ansi-bold" style="color: rgb(0,0,255)">numpy</span><span class="ansi-bold" style="color: rgb(0,0,255)">.</span><span class="ansi-bold" style="color: rgb(0,0,255)">ma</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> mrecords

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/pandas/core/internals/construction.py:481</span>, in <span class="ansi-cyan-fg">dict_to_mgr</span><span class="ansi-blue-fg">(data, index, columns, dtype, typ, copy)</span>
<span class="ansi-green-intense-fg ansi-bold">    477</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">    478</span>         <span style="color: rgb(95,135,135)"># dtype check to exclude e.g. range objects, scalars</span>
<span class="ansi-green-intense-fg ansi-bold">    479</span>         arrays <span style="color: rgb(98,98,98)">=</span> [x<span style="color: rgb(98,98,98)">.</span>copy() <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">hasattr</span>(x, <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">dtype</span><span style="color: rgb(175,0,0)">&#34;</span>) <span class="ansi-bold" style="color: rgb(0,135,0)">else</span> x <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> x <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> arrays]
<span class="ansi-green-fg">--&gt; 481</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">arrays_to_mgr</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">arrays</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">columns</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">index</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">dtype</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">typ</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">typ</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">consolidate</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">copy</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/pandas/core/internals/construction.py:115</span>, in <span class="ansi-cyan-fg">arrays_to_mgr</span><span class="ansi-blue-fg">(arrays, columns, index, dtype, verify_integrity, typ, consolidate)</span>
<span class="ansi-green-intense-fg ansi-bold">    112</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> verify_integrity:
<span class="ansi-green-intense-fg ansi-bold">    113</span>     <span style="color: rgb(95,135,135)"># figure out the index, if necessary</span>
<span class="ansi-green-intense-fg ansi-bold">    114</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> index <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>:
<span class="ansi-green-fg">--&gt; 115</span>         index <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_extract_index</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">arrays</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">    117</span>         index <span style="color: rgb(98,98,98)">=</span> ensure_index(index)

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/pandas/core/internals/construction.py:655</span>, in <span class="ansi-cyan-fg">_extract_index</span><span class="ansi-blue-fg">(data)</span>
<span class="ansi-green-intense-fg ansi-bold">    653</span> lengths <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(0,135,0)">list</span>(<span style="color: rgb(0,135,0)">set</span>(raw_lengths))
<span class="ansi-green-intense-fg ansi-bold">    654</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">len</span>(lengths) <span style="color: rgb(98,98,98)">&gt;</span> <span style="color: rgb(98,98,98)">1</span>:
<span class="ansi-green-fg">--&gt; 655</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">All arrays must be of the same length</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-intense-fg ansi-bold">    657</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> have_dicts:
<span class="ansi-green-intense-fg ansi-bold">    658</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-intense-fg ansi-bold">    659</span>         <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Mixing dicts with non-Series may lead to ambiguous ordering.</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    660</span>     )

<span class="ansi-red-fg">ValueError</span>: All arrays must be of the same length
</pre></div></div>
</div>
<p>Check the dataframe:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[8], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">df</span><span style="color: rgb(98,98,98)">.</span>head(<span style="color: rgb(98,98,98)">10</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df&#39; is not defined
</pre></div></div>
</div>
<p>Write the csv file - here you should provide a file path and file name for the csv file to be written.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write the csv</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;./data_out.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[9], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># Write the csv</span>
<span class="ansi-green-fg">----&gt; 2</span> <span class="ansi-yellow-bg">df</span><span style="color: rgb(98,98,98)">.</span>to_csv(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">./data_out.csv</span><span style="color: rgb(175,0,0)">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;df&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Topic-analysis">
<h2>Topic analysis<a class="headerlink" href="#Topic-analysis" title="Permalink to this heading"></a></h2>
<p>The topic analysis is carried out using <a class="reference external" href="https://maartengr.github.io/BERTopic/index.html">BERTopic</a> using an embedded model through a <a class="reference external" href="https://spacy.io/">spaCy</a> pipeline.</p>
<p>BERTopic takes a list of strings as input. The more items in the list, the better for the topic modeling. If the below returns an error for <code class="docutils literal notranslate"><span class="pre">analyse_topic()</span></code>, the reason can be that your dataset is too small.</p>
<p>You can pass which dataframe entry you would like to have analyzed. The default is <code class="docutils literal notranslate"><span class="pre">text_english</span></code>, but you could for example also select <code class="docutils literal notranslate"><span class="pre">text_summary</span></code> or <code class="docutils literal notranslate"><span class="pre">text_english_correct</span></code> setting the keyword <code class="docutils literal notranslate"><span class="pre">analyze_text</span></code> as so:</p>
<p><code class="docutils literal notranslate"><span class="pre">ammico.text.PostprocessText(mydict=mydict,</span> <span class="pre">analyze_text=&quot;text_summary&quot;).analyse_topic()</span></code></p>
<section id="Option-1:-Use-the-dictionary-as-obtained-from-the-above-analysis.">
<h3>Option 1: Use the dictionary as obtained from the above analysis.<a class="headerlink" href="#Option-1:-Use-the-dictionary-as-obtained-from-the-above-analysis." title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a list of all the text_english entries per analysed image from the mydict variable as above</span>
<span class="n">topic_model</span><span class="p">,</span> <span class="n">topic_df</span><span class="p">,</span> <span class="n">most_frequent_topics</span> <span class="o">=</span> <span class="n">ammico</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">PostprocessText</span><span class="p">(</span>
    <span class="n">mydict</span><span class="o">=</span><span class="n">mydict</span>
<span class="p">)</span><span class="o">.</span><span class="n">analyse_topic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Reading data from dict.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[10], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># make a list of all the text_english entries per analysed image from the mydict variable as above</span>
<span class="ansi-green-fg">----&gt; 2</span> topic_model, topic_df, most_frequent_topics <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">ammico</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">text</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">PostprocessText</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">mydict</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">mydict</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-yellow-bg">)</span><span style="color: rgb(98,98,98)">.</span>analyse_topic()

File <span class="ansi-green-fg">~/work/AMMICO/AMMICO/ammico/text.py:278</span>, in <span class="ansi-cyan-fg">PostprocessText.__init__</span><span class="ansi-blue-fg">(self, mydict, use_csv, csv_path, analyze_text)</span>
<span class="ansi-green-intense-fg ansi-bold">    276</span>     <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Reading data from dict.</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-intense-fg ansi-bold">    277</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>mydict <span style="color: rgb(98,98,98)">=</span> mydict
<span class="ansi-green-fg">--&gt; 278</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>list_text_english <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">get_text_dict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">analyze_text</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    279</span> <span class="ansi-bold" style="color: rgb(0,135,0)">elif</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>use_csv:
<span class="ansi-green-intense-fg ansi-bold">    280</span>     <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Reading data from df.</span><span style="color: rgb(175,0,0)">&#34;</span>)

File <span class="ansi-green-fg">~/work/AMMICO/AMMICO/ammico/text.py:350</span>, in <span class="ansi-cyan-fg">PostprocessText.get_text_dict</span><span class="ansi-blue-fg">(self, analyze_text)</span>
<span class="ansi-green-intense-fg ansi-bold">    348</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> key <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>mydict<span style="color: rgb(98,98,98)">.</span>keys():
<span class="ansi-green-intense-fg ansi-bold">    349</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> analyze_text <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>mydict[key]:
<span class="ansi-green-fg">--&gt; 350</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-intense-fg ansi-bold">    351</span>             <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Please check your provided dictionary - </span><span class="ansi-bold" style="color: rgb(175,95,0)">\</span>
<span class="ansi-green-intense-fg ansi-bold">    352</span> <span style="color: rgb(175,0,0)">        no </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)"> text data found.</span><span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(98,98,98)">.</span>format(
<span class="ansi-green-intense-fg ansi-bold">    353</span>                 analyze_text
<span class="ansi-green-intense-fg ansi-bold">    354</span>             )
<span class="ansi-green-intense-fg ansi-bold">    355</span>         )
<span class="ansi-green-intense-fg ansi-bold">    356</span>     list_text_english<span style="color: rgb(98,98,98)">.</span>append(<span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>mydict[key][analyze_text])
<span class="ansi-green-intense-fg ansi-bold">    357</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> list_text_english

<span class="ansi-red-fg">ValueError</span>: Please check your provided dictionary -                 no text_english text data found.
</pre></div></div>
</div>
</section>
<section id="Option-2:-Read-in-a-csv">
<h3>Option 2: Read in a csv<a class="headerlink" href="#Option-2:-Read-in-a-csv" title="Permalink to this heading"></a></h3>
<p>Not to analyse too many images on google Cloud Vision, use the csv output to obtain the text (when rerunning already analysed images).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_file_path</span> <span class="o">=</span> <span class="s2">&quot;data_out.csv&quot;</span>
<span class="n">topic_model</span><span class="p">,</span> <span class="n">topic_df</span><span class="p">,</span> <span class="n">most_frequent_topics</span> <span class="o">=</span> <span class="n">ammico</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">PostprocessText</span><span class="p">(</span>
    <span class="n">use_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">csv_path</span><span class="o">=</span><span class="n">input_file_path</span>
<span class="p">)</span><span class="o">.</span><span class="n">analyse_topic</span><span class="p">(</span><span class="n">return_topics</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Reading data from df.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[11], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> input_file_path <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">data_out.csv</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-fg">----&gt; 2</span> topic_model, topic_df, most_frequent_topics <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">ammico</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">text</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">PostprocessText</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">use_csv</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">csv_path</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">input_file_path</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-yellow-bg">)</span><span style="color: rgb(98,98,98)">.</span>analyse_topic(return_topics<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">10</span>)

File <span class="ansi-green-fg">~/work/AMMICO/AMMICO/ammico/text.py:282</span>, in <span class="ansi-cyan-fg">PostprocessText.__init__</span><span class="ansi-blue-fg">(self, mydict, use_csv, csv_path, analyze_text)</span>
<span class="ansi-green-intense-fg ansi-bold">    280</span>     <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Reading data from df.</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-intense-fg ansi-bold">    281</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>df <span style="color: rgb(98,98,98)">=</span> pd<span style="color: rgb(98,98,98)">.</span>read_csv(csv_path, encoding<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">utf8</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-fg">--&gt; 282</span>     <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>list_text_english <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">get_text_df</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">analyze_text</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    283</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-intense-fg ansi-bold">    284</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-intense-fg ansi-bold">    285</span>         <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Please provide either dictionary with textual data or </span><span class="ansi-bold" style="color: rgb(175,95,0)">\</span>
<span class="ansi-green-intense-fg ansi-bold">    286</span> <span style="color: rgb(175,0,0)">                      a csv file by setting `use_csv` to True and providing a </span><span class="ansi-bold" style="color: rgb(175,95,0)">\</span>
<span class="ansi-green-intense-fg ansi-bold">    287</span> <span style="color: rgb(175,0,0)">                     `csv_path`.</span><span style="color: rgb(175,0,0)">&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    288</span>     )

File <span class="ansi-green-fg">~/work/AMMICO/AMMICO/ammico/text.py:372</span>, in <span class="ansi-cyan-fg">PostprocessText.get_text_df</span><span class="ansi-blue-fg">(self, analyze_text)</span>
<span class="ansi-green-intense-fg ansi-bold">    369</span> <span style="color: rgb(95,135,135)"># use csv file to obtain dataframe and put text_english or text_summary in list</span>
<span class="ansi-green-intense-fg ansi-bold">    370</span> <span style="color: rgb(95,135,135)"># check that &#34;text_english&#34; or &#34;text_summary&#34; is there</span>
<span class="ansi-green-intense-fg ansi-bold">    371</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> analyze_text <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>df:
<span class="ansi-green-fg">--&gt; 372</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(
<span class="ansi-green-intense-fg ansi-bold">    373</span>         <span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Please check your provided dataframe - </span><span class="ansi-bold" style="color: rgb(175,95,0)">\</span>
<span class="ansi-green-intense-fg ansi-bold">    374</span> <span style="color: rgb(175,0,0)">                        no </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)"> text data found.</span><span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(98,98,98)">.</span>format(
<span class="ansi-green-intense-fg ansi-bold">    375</span>             analyze_text
<span class="ansi-green-intense-fg ansi-bold">    376</span>         )
<span class="ansi-green-intense-fg ansi-bold">    377</span>     )
<span class="ansi-green-intense-fg ansi-bold">    378</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>df[analyze_text]<span style="color: rgb(98,98,98)">.</span>tolist()

<span class="ansi-red-fg">ValueError</span>: Please check your provided dataframe -                                 no text_english text data found.
</pre></div></div>
</div>
</section>
<section id="Access-frequent-topics">
<h3>Access frequent topics<a class="headerlink" href="#Access-frequent-topics" title="Permalink to this heading"></a></h3>
<p>A topic of <code class="docutils literal notranslate"><span class="pre">-1</span></code> stands for an outlier and should be ignored. Topic count is the number of occurence of that topic. The output is structured from most frequent to least frequent topic.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">topic_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[12], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">topic_df</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;topic_df&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Get-information-for-specific-topic">
<h3>Get information for specific topic<a class="headerlink" href="#Get-information-for-specific-topic" title="Permalink to this heading"></a></h3>
<p>The most frequent topics can be accessed through <code class="docutils literal notranslate"><span class="pre">most_frequent_topics</span></code> with the most occuring topics first in the list.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">most_frequent_topics</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Topic:&quot;</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[13], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> topic <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span class="ansi-yellow-bg">most_frequent_topics</span>:
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Topic:</span><span style="color: rgb(175,0,0)">&#34;</span>, topic)

<span class="ansi-red-fg">NameError</span>: name &#39;most_frequent_topics&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Topic-visualization">
<h3>Topic visualization<a class="headerlink" href="#Topic-visualization" title="Permalink to this heading"></a></h3>
<p>The topics can also be visualized. Careful: This only works if there is sufficient data (quantity and quality).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">topic_model</span><span class="o">.</span><span class="n">visualize_topics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[14], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">topic_model</span><span style="color: rgb(98,98,98)">.</span>visualize_topics()

<span class="ansi-red-fg">NameError</span>: name &#39;topic_model&#39; is not defined
</pre></div></div>
</div>
</section>
<section id="Save-the-model">
<h3>Save the model<a class="headerlink" href="#Save-the-model" title="Permalink to this heading"></a></h3>
<p>The model can be saved for future use.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">topic_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;misinfo_posts&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[15], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">topic_model</span><span style="color: rgb(98,98,98)">.</span>save(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">misinfo_posts</span><span style="color: rgb(175,0,0)">&#34;</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;topic_model&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Example%20faces.html" class="btn btn-neutral float-left" title="Facial Expression recognition with DeepFace" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Example%20summary.html" class="btn btn-neutral float-right" title="Image summary and visual question answering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Scientific Software Center, Heidelberg University.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>